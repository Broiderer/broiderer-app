"use client";
import { useEffect, useRef } from "react";
import styles from "./test-editor-2.module.scss";
import paper from "paper";
import elementToPath from "./utils/elementToPaperPath";
import { distance, getDataForStitches, getStiches } from "./utils/fillStitches";
import { subdividePathForPaperPath } from "./utils/subdividePath";
paper.setup(new paper.Size(1, 1));
paper.view.autoUpdate = false;

const ALLOWED_TAGS = [
  "rect",
  "circle",
  "polygon",
  "polyline",
  "ellipse",
  "path",
];
const OUTLINE_STEP = 1;
const FILL_STEP = 1;
const GRID_STEP = 1;
const ADDITIONAL_STITCH_START = 2;
const ADDITIONAL_STITCH_END = 2;
const RANDOMIZE_FIRST_FILLING_STEP = false;

const getAllNodes = (svgElement: SVGElement): SVGElement[] => {
  if (!svgElement) {
    return [];
  }
  return (ALLOWED_TAGS.includes(svgElement.tagName) ? [svgElement] : [])
    .concat([
      ...(Array.from(svgElement.childNodes) as any).map((node: SVGElement) =>
        getAllNodes(node)
      ),
    ])
    .flat();
};

export default function TestEditor2() {
  const svgRef = useRef<SVGSVGElement>(null);
  const svgPaperRef = useRef<SVGSVGElement>(null);

  useEffect(() => {
    if (!svgPaperRef.current || !svgRef.current) {
      return;
    }

    if (svgRef.current.getAttribute("viewBox")) {
      svgPaperRef.current.setAttribute(
        "viewBox",
        svgRef.current.getAttribute("viewBox")!
      );
    }

    if (svgRef.current.getAttribute("width")) {
      svgPaperRef.current.setAttribute(
        "width",
        svgRef.current.getAttribute("width")!
      );
    }

    if (svgRef.current.getAttribute("height")) {
      svgPaperRef.current.setAttribute(
        "height",
        svgRef.current.getAttribute("height")!
      );
    }

    svgPaperRef.current.innerHTML = "";

    const allNodes = getAllNodes(svgRef.current as any as SVGElement);

    const paperPaths = allNodes
      .map((originalNode, i) => {
        const { pathData, attributes } = elementToPath(originalNode);
        if (pathData) {
          const pathElmTest = new paper.Path(pathData);
          pathElmTest.data.fill = attributes.fill;
          pathElmTest.data.id = `shape-${i + 1}`;
          pathElmTest.closePath();

          return pathElmTest;
        } else {
          return null;
        }
      })
      .filter((el) => !!el);

    const isolatedPaths: paper.Path[] = [];
    paperPaths.forEach((path, i) => {
      if (!path) {
        return new paper.Path();
      }
      let pathT: paper.PathItem = path.clone();
      paperPaths.slice(i + 1).forEach((pathTmp) => {
        pathT = pathT.subtract(pathTmp!);
      });
      pathT.flatten(1);
      isolatedPaths.push(pathT as paper.Path);
    });

    const strokePaths = isolatedPaths.map((path) => {
      const newPath = subdividePathForPaperPath(path.clone(), OUTLINE_STEP);
      newPath.data.fill = "transparent";
      newPath.data.stroke = path?.data.fill;
      return newPath;
    });

    const stitchedPaths = isolatedPaths.map((path) => {
      const stitches = getStiches(
        path.clone()!.pathData,
        GRID_STEP,
        FILL_STEP,
        RANDOMIZE_FIRST_FILLING_STEP
      );

      const filteredStitches = stitches //  no filter anymore

      const newData = getDataForStitches(filteredStitches);
      const newPath = new paper.Path();
      newPath.pathData = newData;
      newPath.data.fill = "transparent";
      newPath.data.stroke = path?.data.fill;
      return newPath;
    });

    [...stitchedPaths, ...strokePaths].filter(path => !!path && path.firstSegment).forEach((path) => {
      for (let i = 0; i < ADDITIONAL_STITCH_START; i++) {
        path.insert(0, path.firstSegment.clone());
      }
      for (let i = 0; i < ADDITIONAL_STITCH_END; i++) {
        path.add(path.lastSegment.clone());
      }
    });

    const allPaths = stitchedPaths;

    strokePaths.forEach((path) => {
      const matchIndex = stitchedPaths.findIndex(
        (stitchPath) => stitchPath.data.id === path.id
      );
      allPaths.splice(matchIndex, 0, path);
    });

    const getClosestPathStartToPoint = (paths: paper.Path[], point: paper.Point) => {
      let closestDistance: number | null = null;
      let closestIndex: number = 0;
      paths.forEach((path, i) => {
        if (closestDistance === null) {
          closestDistance = 10000000;
          closestIndex = i
        } else {
          if (path.lastSegment) {
            const dist = distance({x: point.x, y: point.y}, path.lastSegment.point);
            const dist2 = distance({x: point.x, y: point.y}, path.firstSegment.point);
            if (dist < closestDistance) {
              closestDistance = dist;
              closestIndex = i;
            }

            if (dist2 < closestDistance) {
              closestDistance = dist2;
              closestIndex = i;
            }
          }
        }
      })
      return [paths[closestIndex], closestIndex] as [paper.Path, number];
    }
    let allPathsTmp = allPaths.slice()
    const orderedPaths = allPathsTmp.slice(0, 1);
    for (let i = 1; i < allPaths.length; i++) {
      if (orderedPaths[orderedPaths.length - 1].lastSegment) {
        const [closestPath, closestPathIndex]: [paper.Path, number] = getClosestPathStartToPoint(allPathsTmp, orderedPaths[orderedPaths.length - 1].lastSegment.point)
        allPathsTmp.splice(closestPathIndex, 1)
        orderedPaths.push(closestPath)
      }
    }

    const finalPath = new paper.Path();
    orderedPaths.forEach((path) => {
      finalPath.addSegments(path.segments);
    });

    const pathElm = document.createElementNS(
      "http://www.w3.org/2000/svg",
      "path"
    );
    pathElm.setAttribute("fill", "transparent");
    pathElm.setAttribute("stroke", "black");
    pathElm.setAttribute("stroke-width", "0.5px");
    pathElm.setAttribute("d", finalPath!.pathData);

    svgPaperRef.current?.appendChild(pathElm);
  }, [svgPaperRef, svgRef]);

  const downloadPath = () => {
    console.log(svgPaperRef.current?.outerHTML);
  };

  return (
    <div className={styles["editor-svg"]}>
      <div id="test-editor-svg" className={styles["test-editor-svg"]}>
      <svg version="1.0" xmlns="http://www.w3.org/2000/svg" ref={svgRef}
 width="600" height="260" viewBox="10 5 300 129">
<path d="M174.879 129.181c-10.722-2.186-23.109-6.037-28.105-8.432-2.186-1.041-7.703-2.186-13.324-2.602-9.577-.729-9.889-.833-16.343-5.725-3.643-2.706-8.432-5.517-10.618-6.246-18.008-5.413-22.693-7.703-28.105-13.428l-5.413-5.621-7.599 1.666c-9.16 2.082-27.481 4.268-34.768 4.268-9.785-.104-18.112-8.223-15.822-15.51.52-1.666 1.353-7.807 1.874-13.532.52-5.725 1.353-12.491 1.874-15.094.625-2.602 1.77-8.223 2.706-12.595 2.186-10.722 4.997-16.135 11.763-22.068 7.287-6.454 11.346-6.662 18.737-1.041 2.706 2.186 7.183 5.101 9.785 6.558 2.602 1.457 7.183 4.06 10.305 5.933 5.309 3.123 5.725 3.227 15.51 2.811 9.16-.416 21.027-2.29 30.396-4.684 2.082-.52 5.933-.937 8.536-.937 3.019 0 7.807-1.249 12.908-3.331 7.495-3.019 9.056-3.331 19.57-3.331 7.703 0 15.094.729 22.38 2.186 12.075 2.498 22.588 2.602 40.076.416 5.829-.729 12.908-1.041 16.135-.625 9.368 1.145 21.86 5.621 30.708 10.93 4.58 2.706 10.618 6.246 13.428 7.807 13.116 7.391 19.674 17.384 20.923 31.853 1.145 12.283-.312 16.343-8.328 23.629-3.643 3.227-8.536 8.848-10.93 12.387-3.435 5.101-5.517 6.974-10.201 9.16-3.123 1.457-8.119 3.019-11.034 3.331-2.915.312-7.183 1.561-9.473 2.706-17.176 8.64-57.356 13.428-77.55 9.16zm35.913-1.145c2.29-.52 8.64-1.457 14.053-2.082 10.409-1.249 17.696-3.331 27.065-7.703 3.123-1.457 7.495-2.706 9.785-2.706 2.186 0 6.766-1.249 10.097-2.706 4.892-2.186 6.662-3.747 9.785-8.64 2.186-3.227 7.078-8.848 10.93-12.595 8.536-8.119 9.577-11.034 8.432-22.901-.625-5.829-1.77-10.097-3.851-14.157-3.227-6.35-11.346-14.365-16.863-16.759-1.874-.729-7.287-3.747-11.971-6.558-4.788-2.915-12.179-6.454-16.447-7.911-8.744-3.123-17.904-3.539-46.218-2.082-14.053.833-16.863.625-27.585-1.457-15.926-3.123-28.938-2.602-38.203 1.353-3.539 1.561-8.223 2.811-10.305 2.811-2.082 0-10.826 1.457-19.466 3.227-12.7 2.602-17.488 3.123-25.711 2.811-9.681-.312-10.409-.52-15.718-4.06-3.123-2.082-6.766-4.372-8.223-5.101-1.457-.729-4.892-3.123-7.807-5.205-8.952-6.87-12.595-6.454-21.027 2.29-4.788 4.892-6.87 9.577-8.744 19.049-.625 3.435-1.561 8.328-2.082 10.93-.625 2.602-1.457 9.368-1.978 15.094-.52 5.725-1.249 11.659-1.561 13.116-.416 1.457-.208 4.58.416 6.87 1.666 6.142 6.766 8.952 14.573 8.328 13.428-1.041 27.065-2.915 33.622-4.58 6.454-1.561 7.078-1.561 9.577 0 1.457 1.041 3.435 3.227 4.268 4.892 1.978 3.851 6.35 6.037 19.986 10.409 10.201 3.227 12.491 4.476 20.402 10.722 3.123 2.498 4.892 3.019 12.804 3.539 6.246.416 11.034 1.353 14.677 3.019 6.766 2.915 23.109 7.495 33.622 9.264 8.015 1.457 22.276 1.145 29.667-.52z"/>
<path d="M183.206 119.188c-15.198-1.978-29.979-5.933-31.853-8.744-.833-1.145-2.602-2.186-3.851-2.082-1.249 0-1.666.312-.937.625 .625.208 1.249.937 1.249 1.457 0 .625-2.186-.208-4.788-1.77-3.435-2.082-6.037-2.811-9.264-2.706-5.413.208-9.785-1.249-11.659-3.956-.833-1.145-2.29-2.082-3.331-2.082-1.041 0-4.164-1.145-6.87-2.602-2.811-1.353-6.454-2.811-8.119-3.227-4.372-.937-16.343-6.662-16.343-7.807 0-.52 2.394-.937 5.413-.937l5.413 0-6.246-3.019c-13.116-6.558-19.778-8.536-26.232-7.807-3.227.416-8.536 1.77-11.659 3.019-5.205 2.186-10.514 3.643-14.573 4.164-.833.104-4.268.52-7.495 1.041-4.892.625-6.558.416-8.64-.937-1.457-.937-2.394-2.186-2.186-2.602.937-1.457 9.993-2.498 19.882-2.29 6.246.208 10.618-.312 13.012-1.249 1.978-.833 6.35-1.874 9.681-2.29 4.892-.52 6.037-1.041 5.725-2.394-.208-1.145-1.249-1.666-2.915-1.561-8.952.729-21.86.729-21.86.104 0-1.353 4.684-2.186 12.595-2.29 5.205-.104 8.536-.625 9.681-1.561 1.145-.937 1.353-1.77.625-2.186-.729-.416-.833-1.561-.208-3.227.625-1.457.52-3.747 0-5.621-.625-1.666-1.041-4.164-.937-5.413.104-1.77-.52-2.394-1.978-2.394-2.394 0-2.706 1.041-.833 2.915 2.186 2.186.312 2.186-3.123 0-3.435-2.186-3.539-3.956-.208-3.956 1.041 0 2.29-.52 2.706-1.145.312-.625 1.457-.937 2.498-.625 1.249.312 2.29-.312 3.019-1.978.625-1.353 1.978-2.498 2.915-2.498 1.041 0 7.078-.312 13.324-.625 6.35-.312 16.135-.52 21.756-.416 11.346.104 23.734-2.082 29.042-5.205 5.205-3.123 14.157-4.997 27.169-5.829 8.744-.52 12.075-.416 12.075.52 0 .729-3.227 1.145-9.785 1.145-10.826 0-21.548 2.082-28.001 5.309-7.703 3.956-15.302 5.413-30.916 5.725-28.001.625-33.831.937-35.08 1.77-.729.416-1.77 2.706-2.394 4.892-.937 3.643-.833 4.476 1.145 7.287 1.874 2.498 2.811 2.915 4.997 2.394 1.457-.312 3.019-1.145 3.435-1.666.416-.625 2.29-.416 4.997.729 3.227 1.249 4.788 1.457 5.621.625 .833-.833 1.874-.208 3.747 2.082 2.29 2.811 3.435 3.331 7.599 3.331 2.706.104 5.101-.104 5.205-.312 4.372-5.933 7.495-9.264 8.64-9.264 1.77 0 1.978 1.77.208 2.29-.625.208-.937 1.249-.52 2.186 1.145 3.019 7.391 2.29 11.45-1.353 3.643-3.123 5.933-3.956 5.933-2.082 0 .625-.416 1.041-1.041 1.041-1.666 0-1.249 3.123.52 3.851.937 .312 1.561 1.561 1.353 2.811-.208 1.666.312 2.29 2.498 2.498 2.29.312 3.331-.312 4.788-2.915l1.978-3.227.625 2.915c.312 1.77-.104 4.06-1.145 5.829-1.666 2.706-1.666 3.019 0 3.956 2.498 1.353 6.35 8.015 5.413 9.368-.52.833-.312.937 .729.312 .833-.416 4.476-.937 8.223-1.041 7.807-.104 13.012-1.249 20.298-4.58 4.06-1.874 6.974-2.394 13.012-2.29 4.268 0 9.16-.52 10.826-1.249 2.915-1.145 3.019-1.457 3.227-9.577.312-11.763 4.164-17.071 10.097-13.74 1.457.729 5.829 1.249 10.618 1.145 7.287 0 8.119.104 6.35 1.353-1.041.833-2.29 1.457-2.706 1.457-.833 0-2.394 4.06-1.77 4.684 1.145 1.145 6.037 1.666 6.037.625 0-1.666 7.495-9.473 9.056-9.473 3.123 0 6.558 2.498 6.558 4.788 0 1.353.52 2.706 1.041 3.019 1.77 1.041 5.101-.52 5.725-2.706.729-2.29 2.602-2.706 2.602-.52 0 2.394 2.082 3.019 4.06 1.249 1.041-.937 2.602-1.666 3.643-1.666 1.561 0 1.353.52-1.041 3.019-1.561 1.77-3.227 2.915-3.643 2.602-1.457-.833-2.082 1.561-.937 3.747 1.145 2.082 5.205 2.915 5.205 1.041 0-.52 1.145-2.082 2.602-3.539 1.978-1.978 3.123-2.394 5.413-1.77 1.561.416 3.539 1.874 4.164 3.331.729 1.353 1.353 2.082 1.353 1.561 0-.625.52-.52 1.249.208 .937.937 1.666.833 3.123-.52 1.77-1.561 1.457-1.77-4.892-3.956-4.268-1.561-7.703-3.539-9.264-5.413-1.457-1.666-4.58-3.747-7.078-4.476-2.498-.833-6.766-2.602-9.473-3.956-7.911-3.747-27.273-5.621-33.31-3.227-2.706 1.145-2.811 1.353-1.145 3.123 2.602 2.915 1.249 3.435-3.331 1.249-4.788-2.29-5.621-4.164-2.29-5.413 1.874-.729 1.145-.937-3.851-1.353-3.435-.208-8.432-1.457-11.138-2.706-2.706-1.249-5.413-2.29-5.933-2.29-.625 0-1.145-.52-1.145-1.145 0-.625.625-.937 1.457-.625.833 .312 1.666.208 1.874-.312.208-.52 3.747-.208 7.911.729 6.246 1.353 8.536 1.457 12.491.52 8.223-2.082 21.235-2.602 28.938-1.353 8.223 1.353 20.819 7.183 26.856 12.283 2.29 1.874 4.788 3.435 5.621 3.435 2.811 0 14.781 8.848 17.488 12.804 3.227 4.997 3.747 7.391 2.29 10.722-1.561 3.435-2.706 3.123-3.123-.833-.312-2.915-.729-3.539-3.331-3.747-6.454-.729-6.142 4.372.52 7.495 4.892 2.186 7.183 5.933 5.101 8.432-.729.833-1.666 1.561-2.186 1.561-1.874 0-17.384 13.845-20.507 18.321-3.331 4.684-7.287 7.078-11.138 6.87-2.706-.208-7.183 1.561-13.22 5.309-2.706 1.666-5.309 2.706-5.829 2.394-.52-.312-3.435.104-6.558.937-6.662 1.77-12.075 1.978-12.595.416-.208-.52-1.145-.729-2.29-.312-1.457.52-1.561.937-.416 1.666.833 .625-1.041.833-5.517.416-4.476-.312-8.223 0-10.93.937-4.788 1.77-4.06 1.77-18.112 0zm18.529-2.394c.312-1.041-.52-1.353-3.019-1.041-1.874.208-3.539.937-3.851 1.666-.312 1.041.52 1.353 3.019 1.041 1.874-.208 3.539-.937 3.851-1.666zm-14.053-3.435c-.312-1.249-1.457-1.978-3.019-1.978-2.915 0-3.331 2.498-.729 3.956 2.498 1.457 4.372.416 3.747-1.978zm43.407.937c0-1.353-5.517-.625-5.933.833-.208.729 .833.937 2.811.625 1.666-.208 3.123-.937 3.123-1.457zm-63.914-.833c-4.788-2.394-6.142-2.602-5.621-.833.52 1.353 4.06 2.706 7.599 2.811 1.353 0 .625-.729-1.978-1.978zm29.459-1.457c0-.52.52-1.249 1.353-1.77.833-.52.52-.833-1.041-.625-3.123.208-5.309 3.643-2.186 3.435 1.041 0 1.978-.52 1.874-1.041zm-21.235-1.77c0-.833-1.249-1.561-3.123-1.77-3.123-.416-3.123-.416-1.145 1.77 2.186 2.394 4.268 2.394 4.268 0zm47.779 1.561c2.915-1.145 1.874-3.539-1.457-3.539-3.123 0-4.476 2.394-1.77 3.435.625 .312 1.353.625 1.457.625 .104.104 .833-.208 1.77-.52zm15.198-2.498c0-.625-1.145-1.041-2.602-1.041-2.394 0-3.539 1.874-1.978 3.435.937 .833 4.58-1.145 4.58-2.394zm-30.396.312c.208-.937-.729-1.353-2.811-1.353-2.186 0-3.227.52-3.227 1.666 0 1.978 5.309 1.666 6.037-.312zm-48.716-.312c0-1.249-4.164-3.435-4.997-2.602-.416.416 .208 1.353 1.249 2.186 2.394 1.666 3.747 1.874 3.747.416zm24.774-.833c.312-1.041-1.041-1.145-4.788-.312-.208.104 0 .625.312 1.249.937 1.353 3.851.833 4.476-.937zm49.133-2.811c1.041-1.249.937-1.561-.833-1.561-2.811 0-5.413 1.041-5.413 2.186 0 1.561 4.892 1.041 6.246-.625zm-61.624-1.145c-.937-1.041-2.498-1.457-3.435-1.041-2.394.937-.937 2.706 2.394 2.706 2.498 0 2.602-.104 1.041-1.666zm40.493.833c.625-.416 1.666-1.978 2.29-3.539.833-2.394.729-2.602-.937-2.186-2.186.625-5.413 4.892-4.476 5.933.833 .833 1.561.729 3.123-.208zm31.437-.833c.833-.729-1.249-2.498-3.019-2.498-1.874 0-3.539 2.394-2.394 3.539.625 .625 4.372-.104 5.413-1.041zm-102.325-2.082c-.312-.937-.625-2.082-.625-2.706 0-.52-.625-.833-1.249-.52-.729.208-1.353.833-1.353 1.353 0 .52-.312 1.457-.729 1.978-.416.625 .416 1.249 1.978 1.353 1.978.104 2.498-.208 1.978-1.457zm83.171-.416c0-.937-1.145-1.666-2.811-1.874-2.394-.312-2.915.104-2.915 1.874 0 1.77.52 2.186 2.915 1.874 1.666-.208 2.811-.937 2.811-1.874zm-42.783-1.249c1.353-2.186-.208-5.309-2.706-5.829-1.666-.312-2.811 3.019-2.082 6.35.416 2.29 3.227 1.978 4.788-.52zm-34.143-4.58c-.729-2.602-3.643-3.539-3.851-1.145-.208 2.29.312 4.372 1.457 5.725 1.561 1.978 3.227-1.145 2.394-4.58zm51.839 4.268c.416-1.145-.312-1.978-2.082-2.602-1.457-.625-2.811-1.041-3.123-1.041-.729 0-.52 3.747.312 4.476 1.249 1.353 4.268.729 4.892-.833zm52.464-.208c.208-.833-.625-1.353-2.29-1.353-2.706 0-4.164 1.249-3.019 2.498 1.145 1.145 4.788.208 5.309-1.145zm-120.021-.312c.52-.937-5.205-5.205-6.974-5.205-1.874 0-.625 2.082 2.602 4.06 3.956 2.498 3.539 2.394 4.372 1.145zm28.105-1.041c.729-2.394-1.249-6.558-2.915-5.933-1.457.416-2.186 4.268-1.353 6.558.833 2.186 3.539 1.77 4.268-.625zm-23.213-4.892c-.208-2.498-.833-4.476-1.353-4.476-.52 0-.937.625-.937 1.353 0 .625-.312 2.29-.625 3.643-.52 1.666-.208 2.29 1.041 2.29.937 0 1.666.52 1.666 1.249 0 .625.208 .937.312 .729.208-.208.208-2.394-.104-4.788zm35.184 4.268c0-1.353-2.186-4.58-3.123-4.58-1.457 0-1.249 2.498.208 3.956 1.353 1.353 2.915 1.666 2.915.625zm34.768-2.394c1.666-.416 3.227-1.249 3.539-1.978.312-1.041-.208-1.041-2.29-.104-2.394 1.145-3.123.937-5.621-1.457-2.186-2.082-3.227-2.498-4.164-1.561-.833.833-1.561.833-2.602 0-1.145-.937-1.874-.833-3.227.625-2.186 2.498-1.249 3.435 2.602 2.602 3.227-.625 6.558 1.249 5.413 3.123-.416.729 0 .833 1.353.208 1.041-.416 3.331-1.041 4.997-1.457zm62.561.833c.416-.625.52-1.249.312-1.457-.729-.729-4.997.729-4.997 1.666 0 1.353 3.851 1.145 4.684-.208zm-29.875-1.145c-.312-.729-1.561-1.874-3.019-2.602-3.019-1.561-4.997-.104-3.019 2.29 1.561 1.874 6.662 2.186 6.037.312zm-14.365-.833c0-1.249-4.268-3.123-5.517-2.394-.416.312-.312 1.145.416 1.978 1.353 1.666 5.101 1.978 5.101.416zm28.522-1.561c-.416-.937 0-1.561.729-1.561.833 0 3.019-2.186 4.892-4.684 5.413-7.078 2.915-11.034-7.703-12.387-4.476-.52-5.517-.312-7.183 1.457-1.041 1.145-2.498 2.082-3.123 2.082-1.666 0-2.706 2.602-1.978 4.997.52 1.353.416 1.457-.416.312-.52-.729-1.249-.937-1.561-.416-.729 1.249.416 2.915 2.602 3.747 1.145.416 1.561 1.353 1.145 2.915-.52 1.978-.312 2.186 1.666 1.666 2.811-.729 9.681 1.145 8.952 2.498-.416.52 .104.937 .937.937 1.041 0 1.353-.625 1.041-1.561zm20.507-3.227c.833-4.892.52-5.621-2.811-5.621-3.123 0-7.911 4.476-7.078 6.558.52 1.457 6.246 3.851 8.223 3.435.52-.208 1.353-2.082 1.666-4.372zm-56.94 2.082c1.145-3.123.625-3.851-1.457-1.978-1.145 1.041-1.77 2.29-1.457 2.706.833 1.457 2.186 1.145 2.915-.729zm-28.522-1.978c0-1.249-2.186-2.602-4.268-2.602-1.457 0-1.145 3.956.416 4.476 1.874.625 3.851-.312 3.851-1.874zm45.593-2.186c.416-.208-6.87-7.703-7.495-7.703-1.041 0-.625 5.101.416 5.725.625 .312 1.041 2.082 1.041 3.851l0 3.227 2.915-2.498c1.561-1.353 2.915-2.498 3.123-2.602zm-111.797 2.394c-.833-2.394-6.766-6.246-7.807-5.205-1.145 1.145 2.811 5.101 5.829 5.829 1.145.312 2.186.52 2.29.625 .104 0 0-.52-.312-1.249zm84.525-1.561c-1.353-1.353-1.874-1.457-2.915-.416-1.041 1.041-1.041 1.561.104 2.186.833 .52 2.186.729 2.915.416 1.249-.52 1.249-.833-.104-2.186zm-56.836-2.706c0-4.164-1.666-5.725-3.747-3.539-1.145 1.145-1.249 2.186-.52 4.268 1.561 4.164 4.268 3.643 4.268-.729zm63.498.937c0-2.186-4.06-4.164-5.621-2.602-.833.833-.52 1.666 1.457 3.123 2.706 2.082 4.164 1.874 4.164-.52zm-35.392-.416c0-1.145.312-2.706.625-3.643.416-1.041-.52-2.082-2.706-3.227-3.123-1.561-3.539-1.561-4.997-.104-1.561 1.561-1.561 1.978.208 5.309 2.29 4.164 6.87 5.309 6.87 1.666zm-50.694-4.372c-.312-1.145-1.353-2.498-2.394-3.019-3.227-1.77-3.747 3.227-.625 7.078.833 1.145 1.249 1.145 2.29-.312.625-.937 1.041-2.602.729-3.747zm79.112-3.747c-1.457-1.145-2.29-.937-5.205 1.874-2.811 2.811-3.123 3.643-2.29 5.413 1.041 1.874 1.353 1.77 5.205-1.978 3.747-3.643 3.956-4.164 2.29-5.309zm-13.012 5.621c.312-1.561-.104-1.77-2.602-1.145-3.851.937-4.268 1.353-2.394 2.602 2.186 1.353 4.58.729 4.997-1.457zm28.105-.937c-.416-3.019-3.956-3.956-3.956-1.041 0 2.29.833 3.331 2.811 3.331.937 0 1.353-.833 1.145-2.29zm-54.441-.833c0-.833-.833-1.666-1.77-1.874-1.353-.208-1.874.312-1.874 1.874 0 1.561.52 2.082 1.874 1.874.937-.208 1.77-1.041 1.77-1.874zm-26.544-1.041c1.249-2.186.312-4.684-2.706-7.703-3.956-4.06-6.454-.625-3.956 5.621 1.874 4.684 4.788 5.517 6.662 2.082zm95.35-1.145c1.561-1.77 1.666-2.29.416-3.019-1.874-1.145-4.164.625-4.164 3.227 0 2.602 1.249 2.498 3.747-.208zm-117.002-.625c3.123-3.747 3.331-4.788.729-3.956-2.394.729-6.142 3.956-6.142 5.205 0 1.249 3.956.312 5.413-1.249zm157.807-1.041c-.208-1.457-.937-3.019-1.77-3.227-.833-.312-1.145 0-.729.625 .416.729 .208 2.186-.416 3.331-.937 1.77-.833 2.082 1.041 2.082 1.77 0 2.186-.52 1.874-2.811zm8.952 1.874c.312-.52-.52-1.666-1.978-2.602-2.811-1.874-4.58-.416-2.602 1.978 1.457 1.77 3.747 2.082 4.58.625zm-69.743-1.666c.312-.937-.104-1.874-.937-2.186-1.874-.729-4.892 1.457-4.06 2.811.937 1.561 4.268 1.041 4.997-.625zm53.088.937c2.082-.729 2.186-3.435.208-4.164-.833-.312-1.145-1.561-.833-3.123.208-1.353-.104-2.602-.729-2.602-.625-.104-1.561-.208-2.082-.312-.625 0-1.666-.729-2.29-1.353-3.019-3.019-3.956-.52-1.77 4.372.625 1.457 1.77 2.602 2.602 2.602.729 0 1.457.52 1.457 1.041.104 .625.312 1.561.416 2.082.104 .625.312 1.249.416 1.561.104 .625.625 .625 2.602-.104zm-165.198-2.082c.208-.625-.625-2.394-1.874-3.956-1.978-2.498-2.498-2.706-3.747-1.457-2.186 2.29 0 7.287 3.019 6.87 1.249-.208 2.394-.833 2.602-1.457zm83.067-.416c0-2.29-3.019-1.874-3.435.312-.312 1.457.104 1.874 1.561 1.561 1.041-.208 1.874-1.041 1.874-1.874zm13.012 0c1.457-2.706-1.249-4.06-6.454-3.435-2.915.416-3.956 1.041-3.956 2.29 0 2.706.937 3.227 5.309 3.227 2.915 0 4.268-.52 5.101-2.082zm-106.176-.729c-.104-1.978-1.666-3.227-3.019-2.498-.729.52-1.041 1.457-.729 2.082.833 1.249 3.747 1.561 3.747.416zm150.937-2.498c0-1.874-3.643-.52-3.956 1.457-.312 1.666-.104 1.77 1.77.729 1.249-.625 2.186-1.561 2.186-2.186zm-34.039.729c.312-1.145-3.123-3.331-3.956-2.602-.312.416-.312 1.457.104 2.394.729 1.77 3.435 1.978 3.851.208zm-80.465-4.164c0-2.394-3.123-4.268-4.997-3.123-2.394 1.561-2.602 3.019-.729 4.997 1.249 1.249 2.186 1.353 3.747.625 1.041-.625 1.978-1.77 1.978-2.498zm92.748 2.186c2.082-1.561 3.539-10.618 1.978-11.659-.52-.312-2.706.729-4.684 2.29-2.706 2.186-3.643 3.747-3.643 6.142 0 1.77.312 3.539.729 3.851 1.041 1.145 3.747.833 5.621-.625zm12.804-5.309c.104-4.997.104-5.101-3.227-5.309-3.435-.312-3.435-.208-3.435 4.268 0 3.123.52 4.788 1.874 5.517 3.435 2.082 4.58.937 4.788-4.476zm-148.022 3.019c2.706.52 4.268-2.082 3.435-5.621-.937-4.476-1.874-4.684-5.517-.833-2.394 2.498-3.123 3.956-2.602 5.725.312 1.561.937 1.978 1.77 1.353.625-.416 1.978-.729 2.915-.625zm18.321-1.77c-.312-2.082-.833-2.394-4.476-2.082-2.29.208-4.58.729-4.997 1.145-.416.416 .52.625 2.186.312 1.874-.208 3.435.208 4.268 1.249 1.978 2.394 3.435 2.082 3.019-.625zm10.826-1.874c2.186-4.476 2.29-5.205.416-5.205-2.29 0-7.911 5.413-7.911 7.599 0 1.457.625 1.874 2.811 1.561 2.082-.208 3.435-1.353 4.684-3.956zm155.933.52c-1.457-1.77-4.164-2.082-4.164-.625 0 .625 1.041 1.77 2.29 2.706 2.706 1.77 3.851.312 1.874-2.082zm-193.824-2.186c.416-2.602-3.331-6.142-5.517-5.309-2.186.937-1.978 3.019.625 5.829 2.498 2.602 4.476 2.394 4.892-.52zm166.551-.104c.312-2.082-.104-2.394-2.811-2.394-3.435 0-4.788 1.353-3.851 3.747.937 2.602 6.246 1.457 6.662-1.353zm11.346 1.249c.52-1.666-1.978-4.372-4.58-5.205-2.082-.625-2.394-.312-2.394 2.394 0 1.666.312 3.331.729 3.747 1.041 1.041 5.829.312 6.246-.937zm21.964-.833c.208-1.041-.312-1.77-1.249-1.77-1.041 0-1.666.937-1.666 2.186 0 2.498 2.394 2.186 2.915-.416zm-71.409-2.915c-.416-4.788-1.874-6.037-3.435-2.811-.833 1.978-.833 3.227.104 4.892 1.77 3.331 3.747 2.082 3.331-2.082zm67.453-1.457c0-1.457-3.019-3.643-5.101-3.643-1.249 0-1.561 3.435-.416 4.476 1.353 1.353 5.517.729 5.517-.833zm-55.482-3.851c4.06-3.747 2.706-7.078-2.915-7.078-1.145 0-2.915-.52-3.956-1.249-4.476-2.706-7.287 2.186-3.227 5.725 1.145.937 2.082 2.498 2.082 3.331 0 2.394 5.205 1.978 8.015-.729zm23.317-2.186c.416-2.602.208-4.268-.729-4.997-1.874-1.561-3.539-.312-3.539 2.602 0 1.249-.52 2.811-1.145 3.435-1.666 1.666-.104 3.643 2.498 3.227 1.666-.208 2.394-1.249 2.915-4.268zm40.493-2.29c0-.312-3.227-2.082-7.078-4.06-3.956-1.978-8.536-4.684-10.201-6.142-3.747-3.123-15.094-8.536-21.027-10.097-5.101-1.353-18.945-1.561-26.752-.312-6.246.937-17.592.833-21.86-.104-2.706-.52-2.602-.416 1.041 1.457 4.58 2.29 6.454 2.29 27.065 0 8.848-.937 12.7-.937 17.176 0 5.413 1.145 17.8 7.183 24.358 11.867 5.829 4.164 17.28 9.056 17.28 7.391z"/>
<path d="M244.414 87.96c-3.851-3.539-4.684-6.766-2.29-8.536 1.041-.729 2.29-1.353 2.915-1.353.625 0 0 .729-1.249 1.666-1.77 1.249-2.082 1.978-1.249 3.539 3.123 5.933 7.078 6.662 11.554 2.186 3.539-3.539 3.643-3.956 1.249-6.558-1.457-1.561-1.457-1.874-.104-1.874 1.666 0 4.997 3.227 4.997 4.788 0 .625-1.77 2.811-3.956 4.892-4.684 4.58-7.911 4.892-11.867 1.249z"/>
<path d="M245.975 85.461c-3.539-2.915-2.915-4.684 1.978-6.142 3.643-1.145 4.476-1.145 5.725.104 1.249 1.249 1.041 1.874-1.249 4.684-3.227 3.851-3.435 3.851-6.454 1.353z"/>
<path d="M269.084 91.915c-1.145-.312-2.498-.833-2.915-1.353-1.249-1.041 2.186-4.164 4.58-4.164 1.457 0 1.978.729 1.978 3.123 0 1.77-.312 3.019-.729 3.019-.52-.104-1.77-.312-2.915-.625z"/>
<path d="M272.727 98.994c0-1.249 3.019-4.268 4.268-4.268 1.561 0 1.041 1.666-.937 3.435-2.186 1.978-3.331 2.29-3.331.833z"/>
<path d="M148.855 76.093c0-.416 3.123-1.145 6.974-1.457 3.851-.416 10.305-1.874 14.365-3.227 3.956-1.353 9.368-3.019 11.971-3.539l4.684-1.041-5.517-.104c-3.019 0-6.454.416-7.599.937-1.041.625-1.978.729-1.978.208 0-1.874 5.933-3.539 9.889-2.706 3.123.52 3.851.416 3.435-.729-.625-1.978-8.744-3.227-14.573-2.082-2.811.416-4.997.52-4.997.104 0-1.561 3.331-2.082 12.075-2.082 5.101 0 8.744-.416 8.744-1.041 0-.625-2.811-1.041-6.246-1.041-3.747 0-6.246-.416-6.246-1.145 0-.729 1.874-.833 5.725-.416 3.747.52 5.725.416 5.725-.312 0-1.249-1.978-1.978-9.056-3.331-2.706-.52-8.223-1.666-12.283-2.602-3.956-.937-8.848-1.978-10.618-2.29-3.643-.625-4.788-2.394-1.457-2.394 1.041 0 3.747.625 5.933 1.457 2.29.729 6.662 1.77 9.785 2.186 3.123.416 7.703 1.353 10.201 2.186 5.101 1.666 11.554 1.978 10.097.52-.625-.52-2.602-1.353-4.58-1.874-1.978-.52-3.851-1.561-4.06-2.29-.312-1.041 0-1.145 1.77-.104 1.249.625 3.331 1.041 4.58.833 2.394-.416-.208-2.082-14.157-9.368-5.829-3.019-4.58-3.956 1.77-1.353 3.019 1.353 17.488 9.889 19.257 11.554.312 .208-.52 1.353-1.77 2.498-1.249 1.249-2.29 3.331-2.29 4.892 0 3.956 2.29 10.826 3.435 10.409 1.249-.416 1.457-7.078.312-8.952-.416-.625-.208-1.874.416-2.706 3.227-3.851 6.974 0 6.974 7.078 0 4.476-.416 5.205-3.019 6.558-2.186 1.145-3.851 1.249-6.454.52-4.164-1.145-11.034 0-18.008 2.915-7.391 3.123-23.213 5.413-23.213 3.331z"/>
<path d="M31.02 71.096c-5.933-.625-4.684-2.29 1.561-2.186 2.915.104 6.454-.208 7.807-.625 1.666-.52 2.29-.312 2.29.729 0 1.249-5.101 3.227-7.183 2.602-.312-.104-2.394-.312-4.476-.52z"/>
<path d="M145.732 70.056c-4.684-2.082-2.186-3.123 3.227-1.353 2.29.729 5.621 1.041 7.911.625 2.186-.312 5.621-.937 7.599-1.249 5.829-1.041 2.394 1.249-3.956 2.602-7.287 1.561-10.409 1.353-14.781-.625z"/>
<path d="M144.275 64.643c-.312-.416 1.874-1.145 4.892-1.561 7.599-.833 13.22-.729 13.22.312 0 1.77-17.071 3.019-18.112 1.249z"/>
<path d="M44.032 61.624c-2.498-.208-4.476-.833-4.476-1.457 0-.729 1.666-.833 4.58-.416 2.602.416 4.892.312 5.205-.312.312-.52 1.457-.833 2.498-.625.937 .208 3.956.729 6.766 1.041 2.706.312 4.892 1.041 4.892 1.666 0 .833-8.223.937-19.466.104z"/>
<path d="M29.667 60.375c-.416-.625.833-1.041 3.019-1.041 2.082 0 3.747.52 3.747 1.041 0 .625-1.353 1.041-3.019 1.041-1.77 0-3.435-.416-3.747-1.041z"/>
<path d="M143.13 59.438c-1.249-1.249 1.041-1.666 7.703-1.353 4.06.208 7.391.833 7.391 1.353 0 1.041-14.157 1.041-15.094 0z"/>
<path d="M64.539 57.252c-.833-.625-2.811-1.041-4.268-1.041-1.457 0-3.019-.312-3.435-.729-.416-.416-4.268-.625-8.64-.416-5.621.208-9.056-.208-12.179-1.457-2.29-1.041-5.413-2.29-6.87-2.811-2.394-.937-2.394-1.145-.729-2.29 1.457-1.145 2.811-.833 8.119 1.666 4.892 2.29 7.807 3.019 13.22 3.019 3.851.104 7.599.52 8.223 1.145.729 .625 2.186.833 3.227.625 1.041-.312 2.811.104 3.851.833 2.186 1.666 1.77 2.915-.52 1.457z"/>
<path d="M162.908 57.564c-2.29-.208-5.101-.833-6.246-1.249-1.145-.52-4.58-1.249-7.703-1.561-3.019-.312-5.829-.833-6.142-1.145-1.353-1.353 1.041-1.561 6.662-.625 3.435.625 9.577 1.666 13.74 2.29 4.06.729 7.495 1.666 7.495 2.186 0 .416-.833.729-1.77.625-1.041-.104-3.747-.312-6.037-.52z"/>
<path d="M153.851 51.839c-2.811-.625-4.997-1.457-4.997-1.978 0-1.145.208-1.145 5.829.208 2.498.625 4.58 1.561 4.58 2.082 0 .52-.104.833-.208.833-.208-.104-2.498-.625-5.205-1.145z"/>
<path d="M163.949 46.738c-7.807-1.561-9.889-2.186-9.889-3.123 0-.52.729-.937 1.561-.937 2.706 0 14.053 3.539 14.053 4.476 0 .416-.312.625-.729.625-.52-.104-2.706-.52-4.997-1.041z"/>
<path d="M191.846 46.426c-1.353-2.394-8.432-6.87-14.781-9.16-3.227-1.145-6.246-2.498-6.87-3.019-3.019-2.915 11.971 1.457 15.51 4.372 1.561 1.353 4.372 3.747 6.142 5.205 1.978 1.666 2.706 2.915 1.978 3.435-.625.312-1.457 0-1.978-.833z"/>
<path d="M41.117 45.593c-3.331-.833-8.848-3.019-11.867-4.684-.208-.104-.104-.937.208-1.77.52-1.353 1.353-1.249 5.933.416 3.019 1.145 6.558 2.706 7.911 3.643 1.353.833 3.123 1.561 4.06 1.561.833 0 1.561.52 1.561 1.041 0 1.249-2.082 1.145-7.807-.208z"/>
<path d="M168.112 43.72c-3.435-1.666-7.078-3.019-8.015-3.123-1.77 0-2.811-2.082-1.041-2.082 1.978 0 13.74 4.684 15.926 6.35 3.851 2.915.312 2.394-6.87-1.145z"/>
<path d="M55.17 41.013c-3.123-.833-6.662-2.394-7.807-3.435-1.145-1.041-3.747-2.498-5.725-3.227-5.829-2.186-6.037-3.123-.729-2.706 3.539.312 6.142 1.457 9.056 3.747 2.498 1.978 6.35 3.643 9.785 4.372 3.227.729 5.829 1.666 5.829 2.082 0 1.249-3.956.937-10.409-.833z"/>
<path d="M62.977 37.474c-1.041-1.145-2.811-2.082-3.851-2.082-1.041 0-3.019-1.145-4.372-2.602-1.353-1.457-3.123-2.602-3.851-2.602-.833 0-2.811-1.145-4.476-2.602-1.666-1.457-3.643-2.602-4.268-2.602-.729 0-1.874-.729-2.602-1.561-1.145-1.353-.937-2.082 1.041-4.164 3.123-3.331 4.892-3.331 6.454 0 .625 1.353 1.978 2.811 3.123 3.123 1.041.416 1.874 1.145 1.874 1.666 0 .52.729 .937 1.561.937 .833 0 2.811 1.874 4.268 4.164 1.561 2.29 3.227 4.164 3.747 4.164 1.561 0 7.078 4.164 7.078 5.309 0 1.77-3.851.937-5.725-1.145z"/>
<path d="M179.875 30.5c-1.666-.208-2.915-.937-2.915-1.561 0-.625 1.249-.833 3.227-.416 1.77.312 3.956.625 4.684.625 .833 0 1.457.52 1.457 1.041 0 1.041-1.249 1.145-6.454.312z"/>
<path d="M36.954 29.251c-2.29-.312-4.164-1.249-4.164-1.874 0-.729.208-1.457.52-1.457 1.353-.312 9.368 2.602 9.368 3.435 0 .416-.312.729-.729.729-.52-.104-2.706-.52-4.997-.833z"/>
</svg>
      </div>

      <svg
        id="test-zone"
        xmlns="http://www.w3.org/2000/svg"
        ref={svgPaperRef}
      ></svg>
      <button onClick={downloadPath}>Download svg</button>
    </div>
  );
}
